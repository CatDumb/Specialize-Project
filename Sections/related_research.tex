%
% This is the TeX file for the related research section
%
\section{RELATED RESEARCH}
\label{section:related_research}

\subsection{Bus-Related Services}

Previous groups' research has investigated traffic-related value-added services, such as nearby hospitals and automatic teller machines \cite{added_services}. One major candidate for us to continue this research direction is the addition of buses and public transport as a whole. Our research investigates a range of existing applications that provide services related to buses. Through a thorough analysis of established solutions within this field, our objective is to acquire insights that will guide the improvement of our application by finding a compromise between the current system's strengths and weaknesses.

The existing solutions in question are the package offered by FPT in the names of Go!Bus TPHCM and the Buyt TPHCM website, as well as BusMap by Phenikaa MaaS JSC.

\subsubsection{The FPT Ecosystem}

Besides Go!Bus TPHCM, FPT offers a wide set of choices for citizens to track traﬀic data, and these services are linked together. Most notably, the TTGT Tp Ho Chi Minh app allows users to see public cameras for traﬀic. We place particular emphasis on Go!Bus as it aligns with our project's focus, and Buyt TPHCM holds significance for data collection, as detailed in subsequent sections. These applications play pivotal roles in informing our research and development efforts.

\subsubsubsection{Go!Bus}

Fundamentally, Go!Bus offers solely bus-related services like bus stop searching, bus route searching, and routing. The app also has some support for Grab when routing. The home screen for the app is as follows:

\begin{figure}[H]
    \centering
    \includegraphics[width=0.28\textwidth]{assets/images/Research/Bus/gobus_home.png}
    \caption{The home screen for Go!Bus.}
    \label{fig:gobus_homescreen}
\end{figure}

Nevertheless, during our testing of these features, none of them functioned, or had inconsistent uptimes. Here are a few examples of these occurrences.
\begin{figure}[H]
    \centering
    \subfloat[No data for nearby routes.]{
        \includegraphics[width=0.28\linewidth]{assets/images/Research/Bus/gobus_find.png}
        \label{fig:gobus_faul1}
    }
    \hspace{0.5cm} % Add a horizontal space of 1cm
    \subfloat[The stops do not show anything when pressed.]{
        \includegraphics[width=0.28\linewidth]{assets/images/Research/Bus/gobus_routes.png}
        \label{fig:gobus_fault2}
    }
    \hspace{0.5cm} % Add a horizontal space of 1cm
    \subfloat[Embedded web view with server error.]{
        \includegraphics[width=0.28\linewidth]{assets/images/Research/Bus/gobus_instruction.png}
        \label{fig:gobus_fault3}
        }
    \caption{Go!Bus functionalities problems}
\end{figure}

It also portrayed some mobile app bad practices, such as embedding an excessive number of web views into the user interface. Apple, in particular, is not fond of this approach and publicly stated that apps using this will not be accepted in the future \cite{apple_webview}. This is one of the points that we will take into consideration when developing our iOS app.

\subsubsubsection{Buyt TPHCM website}
Buyt TPHCM website is an online resource designed to provide comprehensive information and tools for navigating the public bus system in Ho Chi Minh City. This website aims to enhance the accessibility and user experience of public transportation within the city by offering the following key functionalities:

\begin{itemize}
    \item \textbf{Detailed route information:} The website provides users with comprehensive information on all bus routes in Ho Chi Minh City, including individual stop locations, schedules, and route maps.
    \item \textbf{Real-time bus arrival predictions:} To promote efficient travel planning, buyttphcm.com.vn offers real-time bus arrival predictions for all routes, allowing users to make informed decisions about their travel time.
    \item \textbf{Convenient tools and resources:} This website provides access to the Go!Bus mobile application, enabling users to easily purchase tickets and plan their bus journeys on the go. Additionally, users can find helpful information about the Public Transport Management Center and other relevant resources.
    \item \textbf{Up-to-date news and information:} buyttphcm.com.vn keeps users informed of the latest developments in the Ho Chi Minh City bus system, including temporary route changes, service disruptions, and new initiatives.
\end{itemize}

With its regularly updated resources, Buyt TP HCM will play a crucial role in our data collection process for bus stops and routes in the later stages of our project.

\subsubsection{BusMap}

BusMap rose as a prime solution for city navigation using buses. It also expanded into other regions and countries like Thailand and is overall doing well.

The fundamental bus services like searching and routing are executed well on BusMap, bar some UI lag that could be due to the excessive inclusion of map views. Users can see the bus locations that are coming their way with an estimated time of arrival. There are also other services offered by BusMap, such as JobMap, MotelMap, and driver license support. However, sections like "Blogs" and "News" might be unnecessary for most users.

\begin{figure}[H]
    \centering
    \includegraphics[width=0.3\textwidth]{assets/images/Research/Bus/busmap_home.png}
    \caption{The home screen for BusMap}
    \label{fig:busmap_homescreen}
\end{figure}

\subsubsection{Conclusion}

Both of these apps share a common feature of being equipped with an abundance of supplementary services. While Go!Bus TPHCM is compatible with Grab, BusMap has diversified its partnerships to include other businesses. One apparent limitation of UTraffic is the lack of access to real-time data, such as the current locations of buses and the duration until the next journey. Nevertheless, with sufficient effort and development, our application can excel as a dependable routing and search engine. Ultimately, the primary function of UTraffic is to process congestion data; therefore, we must be careful not to delve too thoroughly into other domains.


\subsection{Parking services}

The need to add parking services to our application originates from the pervasive issue of road congestion, which is compounded by the extensive use of parked automobiles on streets. The existing condition complicates traffic flow and reduces road space availability. Parking services not only handle the difficulty of finding acceptable parking places but also provide customers with compelling incentives for app usage. The availability of simple and efficient parking options encourages consumers to make better use of allotted parking spots. This, in turn, improves the overall user experience while also helping to alleviate traffic congestion by freeing up valuable road real estate.

The existing solutions predominantly reside within Viettel's myparking ecosystem, consisting of two mobile applications: "My parking - Security" and "My parking." The former is a parking management system for security guards, while the latter is a parking search engine for users. We will focus on the latter as it is more relevant to our research.

The system operates by Viettel advertising their parking lot management application to parking lot owners. Subsequently, they leverage the data collected to populate the database of the application, catering to the general public's parking lot search requirements.

\subsubsection{Myparking for owners}

While our exploration of the owner side of the ecosystem is constrained due to the group's inability to register as a parking lot owner, alternative avenues enable us to gain insights into the application. The app's website \cite{myparking_web} informs us that they offer diverse services, including parking lot advertising, camera surveillance, and analytics. Moreover, the application's page on Google Play provides us with a brief preview of their UI.

\begin{figure}[H]
    \centering
    \subfloat[Lot serveillance]{
        \includegraphics[width=0.28\linewidth]{assets/images/Research/Parking/myparking_surveillance.png}
        \label{fig:myparking_ui1}
    }
    \hspace{0.5cm} % Add a horizontal space of 1cm
    \subfloat[List of vehicles with infractions]{
        \includegraphics[width=0.28\linewidth]{assets/images/Research/Parking/myparking_infraction_list.png}
        \label{fig:myparking_ui2}
    }
    \hspace{0.5cm} % Add a horizontal space of 1cm
    \subfloat[Add a new infration]{
        \includegraphics[width=0.28\linewidth]{assets/images/Research/Parking/myparking_new_infraction.png}
        \label{fig:myparking_ui3}
    }
    \caption{Myparking for owners - UI}
\end{figure}

\subsubsection{Myparking for general users}

The application's intended functions are to provide users with a parking lot search engine, book empty lots, and digital payments. The illustrations for the features are as follow:

\begin{figure}[H]
    \centering
    \subfloat[Look for parking lots]{
        \includegraphics[width=0.28\linewidth]{assets/images/Research/Parking/myparking_search.png}
        \label{fig:myparking_ui4}
    }
    \hspace{0.5cm} % Add a horizontal space of 1cm
    \subfloat[Book empty lots]{
        \includegraphics[width=0.28\linewidth]{assets/images/Research/Parking/myparking_book.png}
        \label{fig:myparking_ui5}
    }
    \hspace{0.5cm} % Add a horizontal space of 1cm
    \subfloat[Make digital payments]{
        \includegraphics[width=0.28\linewidth]{assets/images/Research/Parking/myparking_payment.png}
        \label{fig:myparking_ui6}
    }
    \caption{Myparking's functionalities for general users}
\end{figure}

\subsubsection{Conclusion}

Viettel initially enticed parking lot owners by offering attractive incentives to integrate their services into the application, creating a comprehensive platform for users to search, book, and pay for parking spaces. Despite these promising features, the application has faced significant criticism stemming from inadequate administration and maintenance. Users have reported a range of issues, including the improper implementation of payment methods, inaccurate price and availability information, and instances where parking lot owners charge fees both through the app and directly. This dual charging system has led to frustration and mistrust among users, tarnishing the overall reputation of the application. The negative backlash underscores the importance of robust oversight and effective maintenance in ensuring the smooth operation and trustworthiness of such technology-driven services.

\subsection{HCMUT TrafficView}
HCMUT TrafficView is a project developed by the Ho Chi Minh City University of Technology's students that allow users to view the traffic cameras placed around the city. Via the techniques of data labeling and image processing, the project's product is able to assess the traffic status shown by a traffic camera via the traffic density, condition, and give a recommended velocity. The users can choose to view cameras along a path or an individual one. \cite{hcmut_trafficview} Figure \ref{fig:trafficview_demo} shows a traffic camera near \textit{Hai Thuong Lan Ong - Cau Cha Va} with moderate density, unstable flow of traffic condition, and a recommended velocity of 25 km/h.

\begin{figure}[H]
    \centering
    \includegraphics[width=0.7\textwidth]{assets/images/Research/trafficview/hcmut_trafficview_demo.png}
    \caption{Demonstration of HCMUT TrafficView.}
    \label{fig:trafficview_demo}
\end{figure}

The core functionalities, as described by the authoring group, include:
\begin{itemize}
    \item Live traffic camera feed: the system allowing users to select a location of interest and view real-time images.
    \item Congestion predictions: the HCMUT TrafficView predicts the density, level of service, and the average vehicle velocity, which was also demonstrated in Figure \ref{fig:trafficview_demo}.
    \item Route optimization: the system calculates and recommends the shortest path between two locations with respect to the real-time traffic conditions.
\end{itemize}

The group used pretrained models to arrive to their conclusions, including Mobilenet (v3\_large), GoogleNet, and Resnet18, with the reference times being 0.01108 second, 0.014 second, and 0.004 second, respectively.

This is a particular useful application that can have a significant impact on the traffic problem of Ho Chi Minh City. Therefore, the addition of HCMUT TrafficView into the UTraffic system and its mobile apps is an impactful and necessary work. We were tasked with supporting the authoring group in integrating their work into the grand system, and meanwhile, we have also developed a UI to see how the traffic camera feed and the traffic status of it would look like. 

\subsection{UTraffic's system analysis and design}

\subsubsection{Apple's MapKit framework}

Since UTraffic is all about maps, finding the right mapping framework was our first priority. For iOS, we have the options of using Apple's MapKit or the Google Maps Software Development Kit (SDK). We have decided to go with MapKit for the following reasons:

\begin{itemize}
    \item \textbf{Native support}: MapKit is a native framework of iOS, which means that it is developed and maintained by Apple. This ensures that the framework is always up-to-date with the latest iOS version and that it is optimized for the platform. We would be free from any SDK updates that would introduce breaking changes to the app. What is more, native support means that we have reduced development complexity, as we do not have to deal with third-party SDKs. This frees us to focus on the core functionalities of the app and the integration with the backend more easily.
    \item \textbf{Performance}: MapKit is optimized for iOS, which means that it is faster than other frameworks. This is especially important for UTraffic, as we are dealing with a large amount of data and we need to display them on the map as fast as possible.
    \item \textbf{Pricing}: Because MapKit is included in the iOS development tools, we are free from additional paid subscriptions or API calls. There is no dependence on Google's services or ecosystem, so we would have a greater flexibility.
\end{itemize}

While it is true that UTraffic web and its Android app uses Google Map SDK as their map rendering framework, we would not have to worry about incompatibility when rendering using MapKit. The fact that both MapKit and Google Maps use the same mapping standard, WGS-84, along with the OpenStreetMap data used on the UTraffic server being WGS-84 compatible, means that we can easily switch between the two frameworks without having to worry about the data being rendered incorrectly \cite{cllocationcoordinate2d} \cite{a2019_openstreetmap} \cite{google_map}. The World Geodetic System 1984 (WGS-84) is the Global Positioning System (GPS)'s reference, and has become the standard used in cartography, geodesy, and satellite navigation \cite{gisgeography_2015_world}.

\subsubsection{The GeoJSON format}

When we started working on the iOS app of UTraffic, it was crucial to visualize the data onto the map as seamlessly as possible. We have previously chosen MapKit as the mapping framework after examining its compatibility with the WGS-84 mapping standard. However, we still need to find a way to convert the data from the server into a format that is compatible with MapKit. This is where GeoJSON comes in.

\subsubsubsection{GeoJSON definition}

GeoJSON is an open standard geospatial data interchange format that represents simple geographic features and their nonspatial attributes. Based on JavaScript Object Notation (JSON), GeoJSON is a format for encoding a variety of geographic data structures. It uses a geographic coordinate reference system, World Geodetic System 1984, and units of decimal degrees \cite{geojsonarcgis}. 

\begin{figure}[H]
    \centering
    \includegraphics[width=0.75\textwidth]{assets/images/Research/geojson/example_geojson.png}
    \caption{An example of GeoJSON data.}
    \label{fig:geojson_example}
\end{figure}

\subsubsubsection{Feature and geometry types supported by GeoJSON}

The following feature types are supported by GeoJSON:

\begin{itemize}
    \item Point: addresses and locations.
    \item Line string: streets, highways, and boundaries.
    \item Polygon: countries, provinces, and tracts of land.
    \item Multipart collections of points, line strings, or polygons.
\end{itemize}

The following geometry types are supported by GeoJSON:

\begin{itemize}
    \item Point.
    \item LineString.
    \item Polygon.
    \item MultiPoint.
    \item MultiLineString.
    \item MultiPolygon.
\end{itemize}

When rendered onto the map, the geometry types are illustrated in Figure \ref{fig:geojson_geometry}.

\begin{figure}[H]
    \centering
    \includegraphics[width=\textwidth]{assets/images/Research/geojson/geojson_features.png}
    \caption{The geometry types supported by GeoJSON.}
    \label{fig:geojson_geometry}
\end{figure}

\subsubsubsection{The reason for choosing GeoJSON}

We came to choose GeoJSON for the following reasons:

\begin{itemize}
    \item \textbf{WGS-84 comaptible}: As the definition claims, GeoJSON is based on the WGS-84 mapping standard, which is the same standard used by MapKit, Google Maps, and OpenStreetMap. This means that we can easily convert the data from the server into a format that is compatible with MapKit.
    \item \textbf{Ease of understanding}: Because GeoJSON displays data in a structured and human-readable format, it is easy to understand and work with. This is especially important when we are working with a large amount of data, as we can easily visualize the data and see if there are any errors.
    \item \textbf{Ease of testing}: Since GeoJSON is a standard format, we can easily test the data using online tools such as geojson.io \cite{mapbox_geojsonio}. This is especially useful when we are testing the data returned from the server, as we can easily visualize the data and see if there are any errors. Figure \ref{fig:geojson_io} gives an example in how we can see the bus stops within the 500-meter radius of the Ho Chi Minh City University of Technology.
    \begin{figure}[H]
        \centering
        \includegraphics[width=0.9\textwidth]{assets/images/Research/geojson/geojsonio.png}
        \caption{Testing GeoJSON data using geojson.io.}
        \label{fig:geojson_io}
    \end{figure}
    \item \textbf{Support for iOS MapKit framework}: The iOS MapKit framework supports GeoJSON natively via the use of the \lstinline{MKGeoJSONDecoder} class. This class is able to decode GeoJSON data into a list of \lstinline{MKAnnotation} objects, which can then be displayed on the map. This is a great advantage for us, as we do not have to parse the GeoJSON data into our own classes, saving development effort and adhering to Apple's best practices \cite{mkgeojsonobject}. Since it supports iOS 13.0 and newer versions, our target development version, iOS 16.0, is well within the supported range.
\end{itemize}

All in all, GeoJSON is part of our effort in standardizing the data format for UTraffic. We believe there are good reasons to choosing this format as we have explained, given our use cases and the advantages that it brings to the system.

\subsubsection{Implemented APIs}

During our research to improve the performance and coherence of the application, we have developed new API endpoints. They are tailored to work serve two major purposes when it comes to buses, which are the bus routes and the bus stops. The endpoints' description are as follows:
\begin{enumerate}
    \item API endpoints related to bus stops:
    \begin{itemize}
        \item \textbf{Get nearby bus stops}: This endpoint takes in a latitude value, a longitude value, and a radius value in meters. It then returns a list of bus stops that are within the radius of the given location and in the form of GeoJSON.
        \item \textbf{Get nearby disability friendly bus stops}: This endpoint takes the same query paramaters like the nearby bus stops endpoint, but it returns a list of disability friendly bus stops instead.
        \item \textbf{Get the details of a bus stop}: This endpoint takes in a bus stop ID and returns the details of that bus stop.
    \end{itemize}
    \item API endpoints related to bus routes:
    \begin{itemize}
        \item \textbf{Get all bus routes}: This endpoint simply returns all the bus routes in the database to the requesting client. This helps in building a list view for browsing purposes.
        \item \textbf{Get the details of a bus route}: This endpoint takes in a bus route ID and returns the details of that bus route.
        \item \textbf{Get the bus stops along a bus route's path}: This endpoint takes in a bus route ID and the leg, either \textbf{forward} or \textbf{return}. The endpoint then returns the bus stops along that bus route's path, preserving the order of the stops. The response is in the form of GeoJSON.
        \item \textbf{Get the path of a bus route}: This endpoint takes in a bus route ID, and the desired leg and then returns the path of that bus route in the form of GeoJSON.
    \end{itemize}
\end{enumerate}

The details of the API endpoints as well as the deployment efforts that we have done are discussed further in Section \ref{section:implementation}.

We also made changes to the currently deployed API endpoints. At the moment, the endpoint \lstinline{/traffic-status/get-status-v2} receives the query paramaters which are the northeast and southwest bounds of the client's visible map and the zoom level in order to return the appropriate street segments. This endpoint is currently used by the Android app as well as the web version of UTraffic. We have implemented another endpoint, \lstinline{/traffic-status/get-status-v3}, to handle the same functionality but with GeoJSON as the response. This is done by following the GeoJSON's standard format of being a FeatureCollection of Features, where each Feature is a Point with the coordinates of the traffic status. The following is the comparison between the two format when taking a node as an example:

\begin{figure}[H]
    \centering
    \subfloat[The current response format.\label{fig:notgeojson_response}]{%
        \includegraphics[width=0.4\linewidth]{assets/images/Research/API/notgeojson.png}
    }
    \hspace{0.5cm} % Add a horizontal space of 1cm
    \subfloat[The GeoJSON response format.\label{fig:geojson_response}]{%
        \includegraphics[width=0.4\linewidth]{assets/images/Research/API/geojson.png}
    }
    \caption{Comparison between the current response format and the GeoJSON format.}
\end{figure}

